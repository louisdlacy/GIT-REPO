# Component Class

Extends [DisposableObject](https://developers.meta.com/horizon-worlds/reference/2.0.0/core_disposableobject). The core class for creating new types of components and attaching functionality to [entities](https://developers.meta.com/horizon-worlds/reference/2.0.0/core_entity) in a world.

## Signature

```typescript
export declare abstract class Component<TComponent = ComponentWithConstructor<Record<string, unknown>>, TSerializableState extends SerializableState = SerializableState> implements DisposableObject
```

## Examples

In the following example, the NpcItem class extends the Component class to define a new type of component. The new component type is then registered so new instances of the NpcItem can be created in the world.

```typescript
import * as hz from 'horizon/core';

class NpcItem extends hz.Component<typeof NpcItem> {
  static propsDefinition = {};

  start() {}
}
hz.Component.register(NpcItem);
```

## Remarks

The `Component` class is an abstract class that you can extend to create new types of components that add properties and functionality to entities in your world. It provides properties and methods that manage the lifecycle of components, their relationship with attached entities, internal component data, and access to events including code block events.

When you create a new component in Desktop Editor, the editor generates a script that includes the following elements:

- Component.propsDefinition - Defines internal properties for the class, which are also added to the Properties panel in Desktop Editor.
- Component.start() - The method that executes when the class initially loads. This is where you can add event listeners that need to run when the script starts running.
- Component.register() - The method that registers the new component class as a component definition that can be used to generate instances of the component in your world.

For more information about using components, see the [Intro to Scripting](https://developers.meta.com/horizon-worlds/learn/documentation/tutorials/tutorial-worlds/intro-to-desktop-editor-and-typescript/module-2-intro-to-scripting) tutorial, and the [TypeScript Components, Properties, and Variables](https://developers.meta.com/horizon-worlds/learn/documentation/typescript/getting-started/typescript-components-properties-and-variables) guide.

## Properties

| Property | Description |
| --- | --- |
| `async` | A set of asynchronous helper functions that are scoped to the component for automatic cleanup on dispose.<br/>**Signature:** `async: { setTimeout: (callback: TimerHandler, timeout?: number, ...args: unknown[]) => number; clearTimeout: (id: number) => void; setInterval: (callback: TimerHandler, timeout?: number, ...args: unknown[]) => number; clearInterval: (id: number) => void; };`<br/>**Remarks:** setTimeout - Sets a timer that executes a function or specified piece of code once the timer expires. |
| `entity` [readonly] | The entity the component is attached to.<br/>**Signature:** `readonly entity: Entity;` |
| `entityId` [readonly] | The ID of the entity the component is attached to.<br/>**Signature:** `readonly entityId: number;` |
| `props` [readonly] | The properties that modify the component.<br/>**Signature:** `readonly props: GetPropsFromComponentOrPropsDefinition<TComponent>;` |
| `propsDefinition` static | The set of properties that define the available input and default values of the component.<br/>**Signature:** `static propsDefinition: {};` |
| `world` [readonly] | The World instance that contains the component.<br/>**Signature:** `readonly world: World;` |

## Methods

| Method | Description |
| --- | --- |
| `connectCodeBlockEvent(target, event, callback)` | Called when receiving the specified CodeBlockEvent instance from the Player or Entity object.<br/>**Signature:** `connectCodeBlockEvent<TEventArgs extends BuiltInVariableType[], TCallbackArgs extends TEventArgs>(target: Entity \| Player, event: CodeBlockEvent<TEventArgs>, callback: (...payload: TCallbackArgs) => void): EventSubscription;`<br/>**Parameters:** target: Entity \| Player - The entity or player to listen to. event: CodeBlockEvent<TEventArgs> - The incoming CodeBlockEvent object. callback: (...payload: TCallbackArgs) => void - Called when the event is received with any data as arguments.<br/>**Returns:** EventSubscription |
| `connectLocalBroadcastEvent(event, listener)` | Adds a listener to the specified local event. The listener is called when the event is received.<br/>**Signature:** `connectLocalBroadcastEvent<TPayload extends LocalEventData>(event: LocalEvent<TPayload>, listener: (payload: TPayload) => void): EventSubscription;`<br/>**Parameters:** event: LocalEvent<TPayload> - The local event to listen to. listener: (payload: TPayload) => void - Called when the event is received with any data as arguments.<br/>**Returns:** EventSubscription |
| `connectLocalEvent(target, event, callback)` | Adds a listener to the local event on the given entity. The listener is called when the event is received.<br/>**Signature:** `connectLocalEvent<TPayload extends LocalEventData>(target: Entity \| Player, event: LocalEvent<TPayload>, callback: (payload: TPayload) => void): EventSubscription;`<br/>**Parameters:** target: Entity \| Player - The entity to listen to. event: LocalEvent<TPayload> - The local event. callback: (payload: TPayload) => void - Called when the event is received with any data as arguments.<br/>**Returns:** EventSubscription |
| `connectNetworkBroadcastEvent(event, callback)` | Adds a listener to the specified network event. The listener is called when the event is received from the network.<br/>**Signature:** `connectNetworkBroadcastEvent<TPayload extends NetworkEventData>(event: NetworkEvent<TPayload>, callback: (payload: TPayload) => void): EventSubscription;`<br/>**Parameters:** event: NetworkEvent<TPayload> - The network event to listen to. callback: (payload: TPayload) => void - Called when the event is received with any data as arguments.<br/>**Returns:** EventSubscription |
| `connectNetworkEvent(target, event, callback)` | Adds a listener to the specified network event on the given entity. The listener is called when the event is received from network.<br/>**Signature:** `connectNetworkEvent<TPayload extends NetworkEventData>(target: Entity \| Player, event: NetworkEvent<TPayload>, callback: (payload: TPayload) => void): EventSubscription;`<br/>**Parameters:** target: Entity \| Player - The entity or player to listen to. event: NetworkEvent<TPayload> - The network event. callback: (payload: TPayload) => void - Called when the event is received with any data as arguments.<br/>**Returns:** EventSubscription |
| `dispose()` | Called when the component is cleaned up.<br/>**Signature:** `dispose(): void;`<br/>**Returns:** void<br/>**Remarks:** Subscriptions registered using connectCodeBlockEvent, connectLocalEvent, connectNetworkEvent, and connectLocalBroadcastEvent are cleaned up automatically. |
| `getComponents(type)` static | Returns a list of all script component instances of the specified type in the world. Only returns script component instances if they're executing in the same context (i.e. On the server or on a particular client). This method should not be used in prestart() as other script component instances may not yet be instantiated.<br/>**Signature:** `static getComponents<T extends Component<unknown, SerializableState> = Component>(type: new () => T): T[];`<br/>**Parameters:** type: new () => T - The specified type of Component.<br/>**Returns:** T[] - A list of all active instances of the specified component type in the current execution context (i.e., on the server or on a particular client). |
| `preStart()` | Performs initialization tasks before the start method is called.<br/>**Signature:** `preStart(): void;`<br/>**Returns:** void<br/>**Remarks:** This method runs in these scenarios as follows: World start: preStart runs for all components before the start method of any component is called. Asset spawn: preStart runs before any start methods are called for any components that are spawning. Ownership transfer: preStart is called directly before the start method is called. |
| `receiveOwnership(_serializableState, _oldOwner, _newOwner)` | Called when the script's ownership is being transferred to a new player. This method allows the new owner to receive the serializable state from the previous owner during ownership transfer.<br/>**Signature:** `receiveOwnership(_serializableState: TSerializableState \| null, _oldOwner: Player, _newOwner: Player): void;`<br/>**Parameters:** _serializableState: TSerializableState \| null - The serializable state from prior owner, or null if that state is invalid. _oldOwner: Player - The prior owner. _newOwner: Player - The current owner.<br/>**Returns:** void |
| `register(componentClass, componentName)` static | Registers a component class as a component definition that is used to instantiate components of the given type, which also allows them to be attached to entities.<br/>**Signature:** `static register<TComponentPropsDefinition>(componentClass: ComponentWithConstructor<TComponentPropsDefinition> & typeof Component<ComponentWithConstructor<TComponentPropsDefinition>>, componentName?: string): void;`<br/>**Parameters:** componentClass: ComponentWithConstructor<TComponentPropsDefinition> & typeof Component<ComponentWithConstructor<TComponentPropsDefinition>> - The component class to register. componentName: string (Optional) - The name of component to display in the UI.<br/>**Returns:** void<br/>**Remarks:** Component registry is required when you create new classes that extend the abstract Component class. |
| `registerDisposeOperation(operation)` | Called to register a single operation. The operation runs automatically when the component is disposed unless it is manually run or canceled before the component is disposed.<br/>**Signature:** `registerDisposeOperation(operation: DisposeOperation): DisposeOperationRegistration;`<br/>**Parameters:** operation: DisposeOperation - A function called to perform a single dispose operation.<br/>**Returns:** DisposeOperationRegistration - A registration object that can be used to manually run or cancel the operation before dispose. |
| `sendCodeBlockEvent(target, event, args)` | Sends a code block event to the specified player or entity. These events are networked automatically, and sent and handled asynchronously.<br/>**Signature:** `sendCodeBlockEvent<TPayload extends BuiltInVariableType[]>(target: Entity \| Player, event: CodeBlockEvent<TPayload>, ...args: TPayload): void;`<br/>**Parameters:** target: Entity \| Player - The entity or player that receives the event. event: CodeBlockEvent<TPayload> - The CodeBlockEvent that represents the event. args: TPayload - The data to send with the event.<br/>**Returns:** void |
| `sendLocalBroadcastEvent(event, data)` | Sends a local event to all listeners. If a local event is sent, it is sent immediately. This function does not return until delivery completes.<br/>**Signature:** `sendLocalBroadcastEvent<TPayload extends LocalEventData, TData extends TPayload>(event: LocalEvent<TPayload>, data: TData): void;`<br/>**Parameters:** event: LocalEvent<TPayload> - The local event to send. data: TData<br/>**Returns:** void |
| `sendLocalEvent(target, event, data)` | Sends a local event to a specific entity from the owner of the entity.<br/>**Signature:** `sendLocalEvent<TPayload extends LocalEventData, TData extends TPayload>(target: Entity \| Player, event: LocalEvent<TPayload>, data: TData): void;`<br/>**Parameters:** target: Entity \| Player - The entity that receives the event. event: LocalEvent<TPayload> - The local event to send. data: TData<br/>**Returns:** void<br/>**Remarks:** The event is sent immediately and this function does not return until delivery completes. |
| `sendNetworkBroadcastEvent(event, data, players)` | Broadcasts a network event. The event is only handled if the host listens to the event.<br/>**Signature:** `sendNetworkBroadcastEvent<TPayload extends NetworkEventData>(event: NetworkEvent<TPayload>, data: TPayload, players?: Array<Player>): void;`<br/>**Parameters:** event: NetworkEvent<TPayload> - The network event to broadcast. data: TPayload - The data to send with the event. the maximum amount data supported after serialization is 63kB. players: Array<Player> (Optional) - The list of players devices to send the event to. If you do not specify this parameter, the event is sent to all devices owned by the player. You should only use this parameter if you are familiar with how it works.<br/>**Returns:** void |
| `sendNetworkEvent(target, event, data, players)` | Sends a network event to the player that owns the given entity.<br/>**Signature:** `sendNetworkEvent<TPayload extends NetworkEventData>(target: Entity \| Player, event: NetworkEvent<TPayload>, data: TPayload, players?: Array<Player>): void;`<br/>**Parameters:** target: Entity \| Player - The player or entity that recieves the event. event: NetworkEvent<TPayload> - The network event. data: TPayload - The data to send with the event. the maximum amount data after serialization is 63kB. players: Array<Player> (Optional) - The list of player devices to send the event to. If you don't specify this parameter, the event is sent to all devices owned by the player. You should only use specify this parameter if you understand it well.<br/>**Returns:** void<br/>**Remarks:** The event is only handled if connectNetworkEvent is called on the same entity on the owner client. |
| `start()` abstract | Called when the component starts running. This is where you can add event listeners that need to run when the script starts running.<br/>**Signature:** `abstract start(): void;`<br/>**Returns:** void |
| `transferOwnership(_oldOwner, _newOwner)` | Called when transferring the script's ownership to a new player. During the transer, this method can condense the previous owner's state into a serializable format and pass it to the new owner.<br/>**Signature:** `transferOwnership(_oldOwner: Player, _newOwner: Player): TSerializableState;`<br/>**Parameters:** _oldOwner: Player - The original owner. _newOwner: Player - The new owner.<br/>**Returns:** TSerializableState - The serializable state to transfer to the new owner. |